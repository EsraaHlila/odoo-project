<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_invoice_document_custom" inherit_id="account.report_invoice_document">
        <xpath expr="//address[@t-field='o.partner_id']" position="replace">
            <address class="mb-0">
                <t t-if="o.x_parent_id and o.x_parent_id.full_name">
                    <span t-field="o.x_parent_id.full_name"/>
                    <br/>
                    <t t-if="o.partner_id and o.partner_id != o.x_parent_id">
                        <small>(<span t-field="o.partner_id.name"/>)</small>
                        <br/>
                    </t>
                </t>
                <t t-elif="o.partner_id">
                    <span t-field="o.partner_id"/>
                </t>
                <t t-if="o.partner_id">
                    <span t-field="o.partner_id.address" t-options="{'widget': 'contact', 'fields': ['address', 'name'], 'no_marker': True}"/>
                </t>
            </address>
        </xpath>

        <!-- Also update the VAT display to show partner VAT when x_parent_id is used -->
        <xpath expr="//div[@t-if='o.partner_id.vat']" position="replace">
            <div t-if="o.partner_id.vat" id="partner_vat">
                <t t-if="o.company_id.account_fiscal_country_id.vat_label" t-out="o.company_id.account_fiscal_country_id.vat_label" id="inv_tax_id_label"/>
                <t t-else="">Tax ID</t>: <span t-field="o.partner_id.vat"/>
            </div>
        </xpath>
    </template>
</odoo>